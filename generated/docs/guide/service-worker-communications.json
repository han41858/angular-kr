{
  "id": "guide/service-worker-communications",
  "title": "서비스 워커 통신",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com/angular/angular/edit/master/aio/content/guide/service-worker-communications.md?message=docs%3A%20describe%20your%20change...\" aria-label=\"Suggest Edits\" title=\"Suggest Edits\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<!--\n# Service worker communication\n-->\n<h1 id=\"서비스-워커-통신\">서비스 워커 통신<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#서비스-워커-통신\"><i class=\"material-icons\">link</i></a></h1>\n<!--\nImporting `ServiceWorkerModule` into your `AppModule` doesn't just register the service worker, it also provides a few services you can use to interact with the service worker and control the caching of your app.\n-->\n<p><code>AppModule</code>에 <code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code>을 로드하는 것만으로는 서비스 워커를 제대로 등록했다고 할 수 없습니다. 서비스 워커를 제대로 사용하려면 애플리케이션의 데이터를 캐싱할 수 있도록 서비스 워커가 제공하는 서비스를 활용해서 어떤 동작을 실행하도록 해야 합니다.</p>\n<!--\n#### Prerequisites\n-->\n<h4 id=\"사전지식\">사전지식<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#사전지식\"><i class=\"material-icons\">link</i></a></h4>\n<!--\nA basic understanding of the following:\n* [Getting Started with Service Workers](guide/service-worker-getting-started).\n-->\n<p>이 문서의 내용을 제대로 이해하려면 다음 내용을 먼저 보는 것이 좋습니다:</p>\n<ul>\n<li><a href=\"guide/service-worker-getting-started\">서비스 워커 시작하기</a></li>\n</ul>\n<hr>\n<!--\n## `SwUpdate` service\n-->\n<h2 id=\"swupdate-서비스\"><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 서비스<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#swupdate-서비스\"><i class=\"material-icons\">link</i></a></h2>\n<!--\nThe `SwUpdate` service gives you access to events that indicate when the service worker has discovered an available update for your app or when it has activated such an update&mdash;meaning it is now serving content from that update to your app.\n\nThe `SwUpdate` service supports four separate operations:\n* Getting notified of *available* updates. These are new versions of the app to be loaded if the page is refreshed.\n* Getting notified of update *activation*. This is when the service worker starts serving a new version of the app immediately.\n* Asking the service worker to check the server for new updates.\n* Asking the service worker to activate the latest version of the app for the current tab.\n-->\n<p><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 서비스를 사용하면 서비스 워커가 애플리케이션의 새로운 버전을 발견했거나 애플리케이션이 최신버전으로 업데이트된 시점을 알려주는 이벤트를 활용할 수 있습니다.</p>\n<p><code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code> 서비스는 다음과 같은 용도로 사용합니다:</p>\n<ul>\n<li>앱을 업데이트 <em>할 수 있을 때</em> 알림을 받을 수 있습니다. 앱을 새로운 버전으로 실행하려면 먼저 애플리케이션을 업데이트한 후에 페이지를 새로고침해야 합니다.</li>\n<li>업데이트된 앱이 <em>활성화(activation)되었을 때</em> 알림을 받을 수 있습니다. 이 알림은 서비스 워커가 업데이트를 끝내고 새로운 버전의 앱을 실행했을 때 전달됩니다.</li>\n<li>서비스 워커를 사용해서 서버에 새 업데이트가 있는지 확인할 수 있습니다.</li>\n<li>서비스 워커를 사용해서 현재 탭에 최신 버전의 앱을 활성화할 수 있습니다.</li>\n</ul>\n<!--\n### Available and activated updates\n-->\n<h3 id=\"available-activated-이벤트\"><code>available</code>, <code>activated</code> 이벤트<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#available-activated-이벤트\"><i class=\"material-icons\">link</i></a></h3>\n<!--\nThe two update events, `available` and `activated`, are `Observable` properties of `SwUpdate`:\n\n<code-example path=\"service-worker-getting-started/src/app/log-update.service.ts\" header=\"log-update.service.ts\" region=\"sw-update\">\n@Injectable()\nexport class LogUpdateService {\n\n  constructor(updates: SwUpdate) {\n    updates.available.subscribe(event =&gt; {\n      console.log(&#39;current version is&#39;, event.current);\n      console.log(&#39;available version is&#39;, event.available);\n    });\n    updates.activated.subscribe(event =&gt; {\n      console.log(&#39;old version was&#39;, event.previous);\n      console.log(&#39;new version is&#39;, event.current);\n    });\n  }\n}\n\n</code-example>\n\n\nYou can use these events to notify the user of a pending update or to refresh their pages when the code they are running is out of date.\n-->\n<p>업데이트와 관련된 이벤트 중 <code>available</code> 이벤트와 <code>activated</code> 이벤트는 <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a></code>의 프로퍼티로 제공되며, 모두 <code>Observable</code> 타입입니다:</p>\n<code-example path=\"service-worker-getting-started/src/app/log-update.service.ts\" header=\"log-update.service.ts\" region=\"sw-update\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class LogUpdateService {\n\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    updates.available.subscribe(event => {\n      console.log('current version is', event.current);\n      console.log('available version is', event.available);\n    });\n    updates.activated.subscribe(event => {\n      console.log('old version was', event.previous);\n      console.log('new version is', event.current);\n    });\n  }\n}\n\n</code-example>\n<p>이 이벤트들을 활용하면 사용자가 현재 최신 버전의 앱을 사용하지 않고 있으며, 최신 버전으로 업데이트할 수 있고, 새로운 버전을 실행하려면 페이지를 새로고침해야 한다는 알림을 제공할 수 있습니다.</p>\n<!--\n### Checking for updates\n-->\n<h3 id=\"업데이트-확인하기\">업데이트 확인하기<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#업데이트-확인하기\"><i class=\"material-icons\">link</i></a></h3>\n<!--\nIt's possible to ask the service worker to check if any updates have been deployed to the server.\nThe service worker checks for updates during initialization and on each navigation request&mdash;that is, when the user navigates from a different address to your app.\nHowever, you might choose to manually check for updates if you have a site that changes frequently or want updates to happen on a schedule.\n\nDo this with the `checkForUpdate()` method:\n\n<code-example path=\"service-worker-getting-started/src/app/check-for-update.service.ts\" header=\"check-for-update.service.ts\">\nimport { ApplicationRef, Injectable } from &#39;@angular/core&#39;;\nimport { SwUpdate } from &#39;@angular/service-worker&#39;;\nimport { concat, interval } from &#39;rxjs&#39;;\nimport { first } from &#39;rxjs/operators&#39;;\n\n@Injectable()\nexport class CheckForUpdateService {\n\n  constructor(appRef: ApplicationRef, updates: SwUpdate) {\n    // `interval()` 업데이트 여부를 폴링하기 전에, 앱이 안정화되는 것을 기다립니다.\n    const appIsStable$ = appRef.isStable.pipe(first(isStable =&gt; isStable === true));\n    const everySixHours$ = interval(6 * 60 * 60 * 1000);\n    const everySixHoursOnceAppIsStable$ = concat(appIsStable$, everySixHours$);\n\n    everySixHoursOnceAppIsStable$.subscribe(() =&gt; updates.checkForUpdate());\n  }\n}\n\n\n</code-example>\n\nThis method returns a `Promise` which indicates that the update check has completed successfully, though it does not indicate whether an update was discovered as a result of the check. Even if one is found, the service worker must still successfully download the changed files, which can fail. If successful, the `available` event will indicate availability of a new version of the app.\n\n<div class=\"alert is-important\">\n\nIn order to avoid negatively affecting the initial rendering of the page, `ServiceWorkerModule` waits for up to 30 seconds by default for the app to stabilize, before registering the ServiceWorker script.\nConstantly polling for updates, for example, with [setInterval()](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval) or RxJS' [interval()](https://rxjs.dev/api/index/function/interval), will prevent the app from stabilizing and the ServiceWorker script will not be registered with the browser until the 30 seconds upper limit is reached.\n\nNote that this is true for any kind of polling done by your application.\nCheck the <a href='api/core/ApplicationRef#isStable'>isStable</a> documentation for more information.\n\nYou can avoid that delay by waiting for the app to stabilize first, before starting to poll for updates, as shown in the example above.\nAlternatively, you might want to define a different <a href='api/service-worker/SwRegistrationOptions#registrationStrategy'>registration strategy</a> for the ServiceWorker.\n\n</div>\n-->\n<p>서버에 새로운 애플리케이션이 배포되었는지 서비스 워커로 확인할 수 있습니다.\nThe service worker checks for updates during initialization and on each navigation request—that is, when the user navigates from a different address to your app.\nHowever, you might choose to manually check for updates if you have a site that changes frequently or want updates to happen on a schedule.</p>\n<p>Do this with the <code>checkForUpdate()</code> method:</p>\n<code-example path=\"service-worker-getting-started/src/app/check-for-update.service.ts\" header=\"check-for-update.service.ts\">\nimport { <a href=\"api/core/ApplicationRef\" class=\"code-anchor\">ApplicationRef</a>, <a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a> } from '@angular/core';\nimport { <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a> } from '@angular/service-worker';\nimport { concat, interval } from 'rxjs';\nimport { first } from 'rxjs/operators';\n\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class CheckForUpdateService {\n\n  constructor(appRef: <a href=\"api/core/ApplicationRef\" class=\"code-anchor\">ApplicationRef</a>, updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    // `interval()` 업데이트 여부를 폴링하기 전에, 앱이 안정화되는 것을 기다립니다.\n    const appIsStable$ = appRef.isStable.pipe(first(isStable => isStable === true));\n    const everySixHours$ = interval(6 * 60 * 60 * 1000);\n    const everySixHoursOnceAppIsStable$ = concat(appIsStable$, everySixHours$);\n\n    everySixHoursOnceAppIsStable$.subscribe(() => updates.checkForUpdate());\n  }\n}\n\n\n</code-example>\n<p>업데이트 체크가 성공적으로 끝나면 이 메소드는 <code>Promise</code> 타입을 반환하는데, 이 반환값에 업데이트와 관련된 내용이 담겨있지는 않습니다. 이 메소드를 실행하고 업데이트할 수 있는 애플리케이션 최신 버전을 발견하면 서비스 워커가 자동으로 최신 버전을 다운받으며, 앱이 최신버전으로 준비된 이후에 <code>available</code> 이벤트를 보냅니다.</p>\n<div class=\"alert is-important\">\n<p>In order to avoid negatively affecting the initial rendering of the page, <code><a href=\"api/service-worker/ServiceWorkerModule\" class=\"code-anchor\">ServiceWorkerModule</a></code> waits for up to 30 seconds by default for the app to stabilize, before registering the ServiceWorker script.\nConstantly polling for updates, for example, with <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval\">setInterval()</a> or RxJS' <a href=\"https://rxjs.dev/api/index/function/interval\">interval()</a>, will prevent the app from stabilizing and the ServiceWorker script will not be registered with the browser until the 30 seconds upper limit is reached.</p>\n<p>애플리케이션에서 사용하는 폴링 로직은 모두 이런 방식으로 작성되어야 합니다.\n더 자세한 내용은 <a href=\"api/core/ApplicationRef#isStable\">isStable</a> 문서를 참고하세요.</p>\n<p>You can avoid that delay by waiting for the app to stabilize first, before starting to poll for updates, as shown in the example above.\nAlternatively, you might want to define a different <a href=\"api/service-worker/SwRegistrationOptions#registrationStrategy\">registration strategy</a> for the ServiceWorker.</p>\n</div>\n<!--\n### Forcing update activation\n-->\n<h3 id=\"최신버전으로-직접-전환하기\">최신버전으로 직접 전환하기<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#최신버전으로-직접-전환하기\"><i class=\"material-icons\">link</i></a></h3>\n<!--\nIf the current tab needs to be updated to the latest app version immediately, it can ask to do so with the `activateUpdate()` method:\n\n<code-example path=\"service-worker-getting-started/src/app/prompt-update.service.ts\" header=\"prompt-update.service.ts\" region=\"sw-activate\">\n@Injectable()\nexport class PromptUpdateService {\n\n  constructor(updates: SwUpdate) {\n    updates.available.subscribe(event =&gt; {\n      if (promptUser(event)) {\n        updates.activateUpdate().then(() =&gt; document.location.reload());\n      }\n    });\n  }\n}\n\n</code-example>\n\n<div class=\"alert is-important\">\n\nCalling `activateUpdate()` without reloading the page could break lazy-loading in a currently running app, especially if the lazy-loaded chunks use filenames with hashes, which change every version.\nTherefore, it is recommended to reload the page once the promise returned by `activateUpdate()` is resolved.\n\n</div>\n-->\n<p>현재 탭에서 실행하고 있는 앱을 최신 버전으로 즉시 전환하려면 <code>activateUpdate()</code> 메소드를 실행하면 됩니다:</p>\n<code-example path=\"service-worker-getting-started/src/app/prompt-update.service.ts\" header=\"prompt-update.service.ts\" region=\"sw-activate\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class PromptUpdateService {\n\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    updates.available.subscribe(event => {\n      if (promptUser(event)) {\n        updates.activateUpdate().then(() => document.location.reload());\n      }\n    });\n  }\n}\n\n</code-example>\n<div class=\"alert is-important\">\n<p>Calling <code>activateUpdate()</code> without reloading the page could break lazy-loading in a currently running app, especially if the lazy-loaded chunks use filenames with hashes, which change every version.\nTherefore, it is recommended to reload the page once the promise returned by <code>activateUpdate()</code> is resolved.</p>\n</div>\n<h3 id=\"handling-an-unrecoverable-state\">Handling an unrecoverable state<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#handling-an-unrecoverable-state\"><i class=\"material-icons\">link</i></a></h3>\n<p>In some cases, the version of the app used by the service worker to serve a client might be in a broken state that cannot be recovered from without a full page reload.</p>\n<p>For example, imagine the following scenario:</p>\n<ul>\n<li>A user opens the app for the first time and the service worker caches the latest version of the app.\nLet's assume the app's cached assets include <code>index.html</code>, <code>main.&#x3C;main-hash-1>.js</code> and <code>lazy-chunk.&#x3C;lazy-hash-1>.js</code>.</li>\n<li>The user closes the app and does not open it for a while.</li>\n<li>After some time, a new version of the app is deployed to the server.\nThis newer version includes the files <code>index.html</code>, <code>main.&#x3C;main-hash-2>.js</code> and <code>lazy-chunk.&#x3C;lazy-hash-2>.js</code> (note that the hashes are different now, because the content of the files has changed).\nThe old version is no longer available on the server.</li>\n<li>In the meantime, the user's browser decides to evict <code>lazy-chunk.&#x3C;lazy-hash-1>.js</code> from its cache.\nBrowsers may decide to evict specific (or all) resources from a cache in order to reclaim disk space.</li>\n<li>The user opens the app again.\nThe service worker serves the latest version known to it at this point, namely the old version (<code>index.html</code> and <code>main.&#x3C;main-hash-1>.js</code>).</li>\n<li>At some later point, the app requests the lazy bundle, <code>lazy-chunk.&#x3C;lazy-hash-1>.js</code>.</li>\n<li>The service worker is unable to find the asset in the cache (remember that the browser evicted it).\nNor is it able to retrieve it from the server (since the server now only has <code>lazy-chunk.&#x3C;lazy-hash-2>.js</code> from the newer version).</li>\n</ul>\n<p>In the above scenario, the service worker is not able to serve an asset that would normally be cached.\nThat particular app version is broken and there is no way to fix the state of the client without reloading the page.\nIn such cases, the service worker notifies the client by sending an <code><a href=\"api/service-worker/UnrecoverableStateEvent\" class=\"code-anchor\">UnrecoverableStateEvent</a></code> event.\nYou can subscribe to <code><a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>#unrecoverable</code> to be notified and handle these errors.</p>\n<code-example path=\"service-worker-getting-started/src/app/handle-unrecoverable-state.service.ts\" header=\"handle-unrecoverable-state.service.ts\" region=\"sw-unrecoverable-state\">\n@<a href=\"api/core/Injectable\" class=\"code-anchor\">Injectable</a>()\nexport class HandleUnrecoverableStateService {\n  constructor(updates: <a href=\"api/service-worker/SwUpdate\" class=\"code-anchor\">SwUpdate</a>) {\n    updates.unrecoverable.subscribe(event => {\n      notifyUser(\n        `An error occurred that we cannot recover from:\\n${event.reason}\\n\\n` +\n        'Please reload the page.');\n    });\n  }\n}\n\n</code-example>\n<!--\n## More on Angular service workers\n-->\n<h2 id=\"서비스-워커-더-알아보기\">서비스 워커 더 알아보기<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/service-worker-communications#서비스-워커-더-알아보기\"><i class=\"material-icons\">link</i></a></h2>\n<!--\nYou may also be interested in the following:\n* [Service Worker in Production](guide/service-worker-devops).\n-->\n<p>다음 내용도 확인해 보세요:</p>\n<ul>\n<li><a href=\"guide/service-worker-devops\">운영 환경에 서비스 워커 활용하기</a></li>\n</ul>\n\n</div>\n\n<!-- links to this doc:\n - api/service-worker/SwUpdate\n - api/service-worker/UnrecoverableStateEvent\n - api/service-worker/UpdateActivatedEvent\n - api/service-worker/UpdateAvailableEvent\n - guide/service-worker-devops\n - guide/service-worker-getting-started\n - guide/service-worker-intro\n-->\n<!-- links from this doc:\n - api/core/ApplicationRef\n - api/core/ApplicationRef#isStable\n - api/core/Injectable\n - api/service-worker/ServiceWorkerModule\n - api/service-worker/SwRegistrationOptions#registrationStrategy\n - api/service-worker/SwUpdate\n - api/service-worker/UnrecoverableStateEvent\n - guide/service-worker-communications#available-activated-이벤트\n - guide/service-worker-communications#handling-an-unrecoverable-state\n - guide/service-worker-communications#swupdate-서비스\n - guide/service-worker-communications#사전지식\n - guide/service-worker-communications#서비스-워커-더-알아보기\n - guide/service-worker-communications#서비스-워커-통신\n - guide/service-worker-communications#업데이트-확인하기\n - guide/service-worker-communications#최신버전으로-직접-전환하기\n - guide/service-worker-devops\n - guide/service-worker-getting-started\n - https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setInterval\n - https://github.com/angular/angular/edit/master/aio/content/guide/service-worker-communications.md?message=docs%3A%20describe%20your%20change...\n - https://rxjs.dev/api/index/function/interval\n-->"
}