{
  "id": "guide/testing-attribute-directives",
  "title": "어트리뷰트 디렉티브 테스트하기",
  "contents": "\n\n\n  <div class=\"github-links\">\n    <a href=\"https://github.com/angular/angular/edit/master/aio/content/guide/testing-attribute-directives.md?message=docs%3A%20describe%20your%20change...\" aria-label=\"Suggest Edits\" title=\"Suggest Edits\"><i class=\"material-icons\" aria-hidden=\"true\" role=\"img\">mode_edit</i></a>\n  </div>\n\n\n<div class=\"content\">\n<a id=\"attribute-directive\"></a>\n<!--\n# Testing Attribute Directives\n-->\n<h1 id=\"어트리뷰트-디렉티브-테스트하기\">어트리뷰트 디렉티브 테스트하기<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing-attribute-directives#어트리뷰트-디렉티브-테스트하기\"><i class=\"material-icons\">link</i></a></h1>\n<!--\nAn _attribute directive_ modifies the behavior of an element, component or another directive.\nIts name reflects the way the directive is applied: as an attribute on a host element.\n\n<div class=\"alert is-helpful\">\n\n  For the sample app that the testing guides describe, see the <live-example name=\"testing\" embedded-style noDownload>sample app</live-example>.\n\n  For the tests features in the testing guides, see <live-example name=\"testing\" stackblitz=\"specs\" noDownload>tests</live-example>.\n\n</div>\n-->\n<p><em>어트리뷰트 디렉티브(attribute directive)</em> 는 엘리먼트, 컴포넌트, 디렉티브의 동작을 바꿉니다.\n이름에서 알 수 있듯이, 이 디렉티브는 호스트 엘리먼트에 어트리뷰트처럼 사용합니다.</p>\n<div class=\"alert is-helpful\">\n<p>이 문서에서 다루는 예제 앱을 직접 확인하려면 <live-example name=\"testing\" embedded-style=\"\" nodownload=\"\">sample app</live-example> 링크를 참고하세요.</p>\n<p>이 문서에서 다루는 테스트 기능이 동작하는 것을 직접 확인하려면 <live-example name=\"testing\" stackblitz=\"specs\" nodownload=\"\">tests</live-example> 링크를 참고하세요.</p>\n</div>\n<!--\n## Testing the `HighlightDirective`\n-->\n<h2 id=\"highlightdirective-테스트하기\"><code>HighlightDirective</code> 테스트하기<a title=\"Link to this heading\" class=\"header-link\" aria-hidden=\"true\" href=\"guide/testing-attribute-directives#highlightdirective-테스트하기\"><i class=\"material-icons\">link</i></a></h2>\n<!--\nThe sample application's `HighlightDirective` sets the background color of an element\nbased on either a data bound color or a default color (lightgray).\nIt also sets a custom property of the element (`customProperty`) to `true`\nfor no reason other than to show that it can.\n\n<code-example path=\"testing/src/app/shared/highlight.directive.ts\" header=\"app/shared/highlight.directive.ts\">\nimport { Directive, ElementRef, Input, OnChanges } from &#39;@angular/core&#39;;\n\n@Directive({ selector: &#39;[highlight]&#39; })\n/**\n * 엘리먼트의 배경색을 변경하고 customProperty를 true로 설정합니다.\n */\nexport class HighlightDirective implements OnChanges {\n\n  defaultColor =  &#39;rgb(211, 211, 211)&#39;; // lightgray\n\n  @Input(&#39;highlight&#39;) bgColor: string;\n\n  constructor(private el: ElementRef) {\n    el.nativeElement.style.customProperty = true;\n  }\n\n  ngOnChanges() {\n    this.el.nativeElement.style.backgroundColor = this.bgColor || this.defaultColor;\n  }\n}\n\n\n</code-example>\n\nIt's used throughout the application, perhaps most simply in the `AboutComponent`:\n\n<code-example path=\"testing/src/app/about/about.component.ts\" header=\"app/about/about.component.ts\">\nimport { Component } from &#39;@angular/core&#39;;\n@Component({\n  template: `\n  &lt;h2 highlight=&quot;skyblue&quot;&gt;About&lt;/h2&gt;\n  &lt;h3&gt;Quote of the day:&lt;/h3&gt;\n  &lt;twain-quote&gt;&lt;/twain-quote&gt;\n  `\n})\nexport class AboutComponent { }\n\n\n</code-example>\n\nTesting the specific use of the `HighlightDirective` within the `AboutComponent` requires only the techniques explored in the [\"Nested component tests\"](guide/testing-components-scenarios#nested-component-tests) section of [Component testing scenarios](guide/testing-components-scenarios).\n\n<code-example path=\"testing/src/app/about/about.component.spec.ts\" region=\"tests\" header=\"app/about/about.component.spec.ts\">\nbeforeEach(() =&gt; {\n  fixture = TestBed.configureTestingModule({\n    declarations: [ AboutComponent, HighlightDirective ],\n    schemas:      [ NO_ERRORS_SCHEMA ]\n  })\n  .createComponent(AboutComponent);\n  fixture.detectChanges(); // 초기 바인딩\n});\n\nit(&#39;should have skyblue &lt;h2&gt;&#39;, () =&gt; {\n  const h2: HTMLElement = fixture.nativeElement.querySelector(&#39;h2&#39;);\n  const bgColor = h2.style.backgroundColor;\n  expect(bgColor).toBe(&#39;skyblue&#39;);\n});\n\n</code-example>\n\nHowever, testing a single use case is unlikely to explore the full range of a directive's capabilities.\nFinding and testing all components that use the directive is tedious, brittle, and almost as unlikely to afford full coverage.\n\n_Class-only tests_ might be helpful,\nbut attribute directives like this one tend to manipulate the DOM.\nIsolated unit tests don't touch the DOM and, therefore,\ndo not inspire confidence in the directive's efficacy.\n\nA better solution is to create an artificial test component that demonstrates all ways to apply the directive.\n\n<code-example path=\"testing/src/app/shared/highlight.directive.spec.ts\" region=\"test-component\" header=\"app/shared/highlight.directive.spec.ts (TestComponent)\">\n@Component({\n  template: `\n  &lt;h2 highlight=&quot;yellow&quot;&gt;Something Yellow&lt;/h2&gt;\n  &lt;h2 highlight&gt;The Default (Gray)&lt;/h2&gt;\n  &lt;h2&gt;No Highlight&lt;/h2&gt;\n  &lt;input #box [highlight]=&quot;box.value&quot; value=&quot;cyan&quot;/&gt;`\n})\nclass TestComponent { }\n\n</code-example>\n\n<div class=\"lightbox\">\n  <img src='generated/images/guide/testing/highlight-directive-spec.png' alt=\"HighlightDirective spec in action\">\n</div>\n\n<div class=\"alert is-helpful\">\n\nThe `<input>` case binds the `HighlightDirective` to the name of a color value in the input box.\nThe initial value is the word \"cyan\" which should be the background color of the input box.\n\n</div>\n\nHere are some tests of this component:\n\n<code-example path=\"testing/src/app/shared/highlight.directive.spec.ts\" region=\"selected-tests\" header=\"app/shared/highlight.directive.spec.ts (selected tests)\">\nbeforeEach(() =&gt; {\n  fixture = TestBed.configureTestingModule({\n    declarations: [ HighlightDirective, TestComponent ]\n  })\n  .createComponent(TestComponent);\n\n  fixture.detectChanges(); // 초기 바인딩\n\n  // HighlightDirective를 사용한 엘리먼트를 모두 쿼리합니다.\n  des = fixture.debugElement.queryAll(By.directive(HighlightDirective));\n\n  // HighlightDirective를 사용하지 않은 h2를 쿼리합니다.\n  bareH2 = fixture.debugElement.query(By.css(&#39;h2:not([highlight])&#39;));\n});\n\n// 색상 테스트\nit(&#39;should have three highlighted elements&#39;, () =&gt; {\n  expect(des.length).toBe(3);\n});\n\nit(&#39;should color 1st &lt;h2&gt; background &quot;yellow&quot;&#39;, () =&gt; {\n  const bgColor = des[0].nativeElement.style.backgroundColor;\n  expect(bgColor).toBe(&#39;yellow&#39;);\n});\n\nit(&#39;should color 2nd &lt;h2&gt; background w/ default color&#39;, () =&gt; {\n  const dir = des[1].injector.get(HighlightDirective) as HighlightDirective;\n  const bgColor = des[1].nativeElement.style.backgroundColor;\n  expect(bgColor).toBe(dir.defaultColor);\n});\n\nit(&#39;should bind &lt;input&gt; background to value color&#39;, () =&gt; {\n  // nativeElement를 사용하면 편합니다.\n  const input = des[2].nativeElement as HTMLInputElement;\n  expect(input.style.backgroundColor).toBe(&#39;cyan&#39;, &#39;initial backgroundColor&#39;);\n\n  input.value = &#39;green&#39;;\n\n  // 입력 필드의 값을 변경하고 DOM 이벤트를 보내면 Angular가 이 이벤트에 반응합니다.\n  // IE와 같이 오래된 브라우저에서는 CustomEvent 를 사용해야 합니다. 아래 문서를 참고하세요.\n  // https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent#Polyfill\n  input.dispatchEvent(new Event(&#39;input&#39;));\n  fixture.detectChanges();\n\n  expect(input.style.backgroundColor).toBe(&#39;green&#39;, &#39;changed backgroundColor&#39;);\n});\n\n\nit(&#39;bare &lt;h2&gt; should not have a customProperty&#39;, () =&gt; {\n  expect(bareH2.properties.customProperty).toBeUndefined();\n});\n\n</code-example>\n\nA few techniques are noteworthy:\n\n- The `By.directive` predicate is a great way to get the elements that have this directive _when their element types are unknown_.\n\n- The <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/:not\">`:not` pseudo-class</a>\n  in `By.css('h2:not([highlight])')` helps find `<h2>` elements that _do not_ have the directive.\n  `By.css('*:not([highlight])')` finds _any_ element that does not have the directive.\n\n- `DebugElement.styles` affords access to element styles even in the absence of a real browser, thanks to the `DebugElement` abstraction.\n  But feel free to exploit the `nativeElement` when that seems easier or more clear than the abstraction.\n\n- Angular adds a directive to the injector of the element to which it is applied.\n  The test for the default color uses the injector of the second `<h2>` to get its `HighlightDirective` instance\n  and its `defaultColor`.\n\n- `DebugElement.properties` affords access to the artificial custom property that is set by the directive.\n-->\n<p>예제 애플리케이션에 있는 <code>HighlightDirective</code>는 디렉티브에 바인딩되는 색상 데이터나 기본 색상(lightgray)을 엘리먼트 배경색으로 적용하는 디렉티브입니다.\n그리고 엘리먼트에 <code>customProperty</code> 커스텀 프로퍼티 값을 <code>true</code>로 설정하는 동작도 합니다.\n이 커스텀 프로퍼티가 의미있는 역할을 하는 것은 아니지만 테스트 기능을 설명하기 위해 추가했습니다.</p>\n<code-example path=\"testing/src/app/shared/highlight.directive.ts\" header=\"app/shared/highlight.directive.ts\">\nimport { <a href=\"api/core/Directive\" class=\"code-anchor\">Directive</a>, <a href=\"api/core/ElementRef\" class=\"code-anchor\">ElementRef</a>, <a href=\"api/core/Input\" class=\"code-anchor\">Input</a>, <a href=\"api/core/OnChanges\" class=\"code-anchor\">OnChanges</a> } from '@angular/core';\n\n@<a href=\"api/core/Directive\" class=\"code-anchor\">Directive</a>({ selector: '[highlight]' })\n/**\n * 엘리먼트의 배경색을 변경하고 customProperty를 true로 설정합니다.\n */\nexport class HighlightDirective implements <a href=\"api/core/OnChanges\" class=\"code-anchor\">OnChanges</a> {\n\n  defaultColor =  'rgb(211, 211, 211)'; // lightgray\n\n  @<a href=\"api/core/Input\" class=\"code-anchor\">Input</a>('highlight') bgColor: string;\n\n  constructor(private el: <a href=\"api/core/ElementRef\" class=\"code-anchor\">ElementRef</a>) {\n    el.nativeElement.style.customProperty = true;\n  }\n\n  ngOnChanges() {\n    this.el.nativeElement.style.backgroundColor = this.bgColor || this.defaultColor;\n  }\n}\n\n\n</code-example>\n<p>이 디렉티브는 예제 애플리케이션 전반에 활용되며, <code>AboutComponent</code>에는 이렇게 사용되었습니다:</p>\n<code-example path=\"testing/src/app/about/about.component.ts\" header=\"app/about/about.component.ts\">\nimport { <a href=\"api/core/Component\" class=\"code-anchor\">Component</a> } from '@angular/core';\n@<a href=\"api/core/Component\" class=\"code-anchor\">Component</a>({\n  template: `\n  &#x3C;h2 highlight=\"skyblue\">About&#x3C;/h2>\n  &#x3C;h3>Quote of the day:&#x3C;/h3>\n  &#x3C;twain-quote>&#x3C;/twain-quote>\n  `\n})\nexport class AboutComponent { }\n\n\n</code-example>\n<p><code>HighlightDirective</code>가 <code>AboutComponent</code>에 사용되는 경우를 테스트하려면 <a href=\"guide/testing-components-scenarios\">컴포넌트 테스트 시나리오</a> 문서의 <a href=\"guide/testing-components-scenarios#nested-component-tests\">중첩된 컴포넌트 테스트</a> 섹션에서 설명한 내용을 활용하면 됩니다.</p>\n<code-example path=\"testing/src/app/about/about.component.spec.ts\" region=\"tests\" header=\"app/about/about.component.spec.ts\">\nbeforeEach(() => {\n  fixture = TestBed.configureTestingModule({\n    declarations: [ AboutComponent, HighlightDirective ],\n    schemas:      [ <a href=\"api/core/NO_ERRORS_SCHEMA\" class=\"code-anchor\">NO_ERRORS_SCHEMA</a> ]\n  })\n  .createComponent(AboutComponent);\n  fixture.detectChanges(); // 초기 바인딩\n});\n\nit('should have skyblue &#x3C;h2>', () => {\n  const h2: HTMLElement = fixture.nativeElement.querySelector('h2');\n  const bgColor = h2.style.backgroundColor;\n  expect(bgColor).toBe('skyblue');\n});\n\n</code-example>\n<p>하지만 디렉티브가 사용되는 경우 하나를 테스트하는 것이 디렉티브가 활용될 수 있는 모든 경우를 테스트했다고 할 수는 없습니다.\n그렇다고 해서 이 디렉티브가 사용되는 모든 컴포넌트를 함께 테스트하는 것은 또 복잡하고 번거로우며 지루한 작업이 될 것입니다.</p>\n<p>이런 경우에 <em>클래스만 테스트하는 방법</em> 이 도움이 될 수 있지만, DOM을 조작하는 어트리뷰트 디렉티브를 테스트하기에는 적합하지 않습니다.\n디렉티브 클래스만 테스트하는 방식은 DOM을 활용하지 않기 때문에 이 디렉티브가 DOM에서 어떻게 동작하는지 제대로 알 수 없습니다.</p>\n<p>그렇다면 테스트 컴포넌트를 원하는 모양으로 만들어서 디렉티브가 활용될 수 있는 상황을 다양하게 검사하는 방법이 좋습니다.</p>\n<code-example path=\"testing/src/app/shared/highlight.directive.spec.ts\" region=\"test-component\" header=\"app/shared/highlight.directive.spec.ts (TestComponent)\">\n@<a href=\"api/core/Component\" class=\"code-anchor\">Component</a>({\n  template: `\n  &#x3C;h2 highlight=\"yellow\">Something Yellow&#x3C;/h2>\n  &#x3C;h2 highlight>The Default (Gray)&#x3C;/h2>\n  &#x3C;h2>No Highlight&#x3C;/h2>\n  &#x3C;input #box [highlight]=\"box.value\" value=\"cyan\"/>`\n})\nclass TestComponent { }\n\n</code-example>\n<div class=\"lightbox\">\n  <img src=\"generated/images/guide/testing/highlight-directive-spec.png\" alt=\"HighlightDirective spec in action\" width=\"200\" height=\"159\">\n</div>\n<div class=\"alert is-helpful\">\n<p><code>&#x3C;input></code>에 바인딩 된 <code>HighlightDirective</code>는 입력 필드에 입력된 값에 따라 배경색을 설정합니다.\n이 엘리먼트의 초기값은 \"cyan\"이기 때문에 입력 필드의 배경색도 \"cyan\"으로 지정됩니다.</p>\n</div>\n<p>이 컴포넌트는 이렇게 테스트할 수 있습니다:</p>\n<code-example path=\"testing/src/app/shared/highlight.directive.spec.ts\" region=\"selected-tests\" header=\"app/shared/highlight.directive.spec.ts (일부 기능 테스트)\">\nbeforeEach(() => {\n  fixture = TestBed.configureTestingModule({\n    declarations: [ HighlightDirective, TestComponent ]\n  })\n  .createComponent(TestComponent);\n\n  fixture.detectChanges(); // 초기 바인딩\n\n  // HighlightDirective를 사용한 엘리먼트를 모두 쿼리합니다.\n  des = fixture.debugElement.queryAll(By.directive(HighlightDirective));\n\n  // HighlightDirective를 사용하지 않은 h2를 쿼리합니다.\n  bareH2 = fixture.debugElement.query(By.css('h2:not([highlight])'));\n});\n\n// 색상 테스트\nit('should have three highlighted elements', () => {\n  expect(des.length).toBe(3);\n});\n\nit('should color 1st &#x3C;h2> background \"yellow\"', () => {\n  const bgColor = des[0].nativeElement.style.backgroundColor;\n  expect(bgColor).toBe('yellow');\n});\n\nit('should color 2nd &#x3C;h2> background w/ default color', () => {\n  const dir = des[1].injector.get(HighlightDirective) as HighlightDirective;\n  const bgColor = des[1].nativeElement.style.backgroundColor;\n  expect(bgColor).toBe(dir.defaultColor);\n});\n\nit('should bind &#x3C;input> background to value color', () => {\n  // nativeElement를 사용하면 편합니다.\n  const input = des[2].nativeElement as HTMLInputElement;\n  expect(input.style.backgroundColor).toBe('cyan', 'initial backgroundColor');\n\n  input.value = 'green';\n\n  // 입력 필드의 값을 변경하고 DOM 이벤트를 보내면 Angular가 이 이벤트에 반응합니다.\n  // IE와 같이 오래된 브라우저에서는 CustomEvent 를 사용해야 합니다. 아래 문서를 참고하세요.\n  // https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent#Polyfill\n  input.dispatchEvent(new <a href=\"api/router/Event\" class=\"code-anchor\">Event</a>('input'));\n  fixture.detectChanges();\n\n  expect(input.style.backgroundColor).toBe('green', 'changed backgroundColor');\n});\n\n\nit('bare &#x3C;h2> should not have a customProperty', () => {\n  expect(bareH2.properties.customProperty).toBeUndefined();\n});\n\n</code-example>\n<p>이런 내용이 중요합니다:</p>\n<ul>\n<li>\n<p><em>엘리먼트의 타입을 알지 못하는 상태에서</em> 원하는 디렉티브를 찾으려면 <code>By.directive</code> 매처를 사용하는 것이 좋습니다.</p>\n</li>\n<li>\n<p>이 디렉티브가 사용되지 않은 <code>&#x3C;h2></code> 엘리먼트를 찾기 위해 <code>By.css('h2:not([highlight])')</code>처럼 <a href=\"https://developer.mozilla.org/en-US/docs/Web/CSS/:not\"><code>:not</code> 가상 클래스(pseudo-class)</a>를 사용했습니다.\n<code>By.css('*:not([highlight])')</code>라고 사용하면 <code>&#x3C;h2></code> 엘리먼트 뿐 아니라 <em>모든</em> 엘리먼트 중에서 디렉티브가 사용되지 않은 엘리먼트를 찾습니다.</p>\n</li>\n<li>\n<p>엘리먼트 스타일을 검사하기 위해 <code><a href=\"api/core/DebugElement#styles\" class=\"code-anchor\">DebugElement.styles</a></code>를 참조했습니다.\n실제로는 브라우저가 스타일을 지원하지 않더라도 추상 클래스 <code><a href=\"api/core/DebugElement\" class=\"code-anchor\">DebugElement</a></code>를 활용하면 스타일 객체에 접근할 수 있습니다.\n추상 클래스보다 더 쉽고 명확하다면 <code>nativeElement</code>를 사용해도 됩니다.</p>\n</li>\n<li>\n<p>Angular는 디렉티브가 적용되는 엘리먼트 인젝터에 이 디렉티브를 등록합니다.\n그래서 두 번째 <code>&#x3C;h2></code>에 있는 인젝터로 <code>HighlightDirective</code> 인스턴스를 참조하고 이 인스턴스에서 <code>defaultColor</code> 값을 가져왔습니다.</p>\n</li>\n<li>\n<p>디렉티브가 설정하는 커스텀 프로퍼티를 찾기 위해 <code><a href=\"api/core/DebugElement#properties\" class=\"code-anchor\">DebugElement.properties</a></code>를 참조했습니다.</p>\n</li>\n</ul>\n<hr>\n\n</div>\n\n<!-- links to this doc:\n - guide/testing\n-->\n<!-- links from this doc:\n - api/core/Component\n - api/core/DebugElement\n - api/core/DebugElement#properties\n - api/core/DebugElement#styles\n - api/core/Directive\n - api/core/ElementRef\n - api/core/Input\n - api/core/NO_ERRORS_SCHEMA\n - api/core/OnChanges\n - api/router/Event\n - guide/testing-attribute-directives#highlightdirective-테스트하기\n - guide/testing-attribute-directives#어트리뷰트-디렉티브-테스트하기\n - guide/testing-components-scenarios\n - guide/testing-components-scenarios#nested-component-tests\n - https://developer.mozilla.org/en-US/docs/Web/CSS/:not\n - https://github.com/angular/angular/edit/master/aio/content/guide/testing-attribute-directives.md?message=docs%3A%20describe%20your%20change...\n-->"
}